<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Laporan Kendala RSGM â€“ User</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --primary:#6366f1;
  --secondary:#22d3ee;
  --bg:#f8fafc;
  --card:#ffffff;
  --text:#0f172a;
  --muted:#64748b;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Poppins,sans-serif;
  background:linear-gradient(135deg,#eef2ff,#f8fafc);
  color:var(--text);
}
.container{max-width:860px;margin:auto;padding:24px}
.header{
  display:flex;flex-direction:column;gap:6px;margin-bottom:24px
}
.header h1{margin:0;font-size:26px;font-weight:700}
.header p{margin:0;color:var(--muted)}
.card{
  background:rgba(255,255,255,.85);
  backdrop-filter:blur(14px);
  border-radius:22px;
  padding:24px;
  margin-bottom:22px;
  box-shadow:0 20px 40px rgba(99,102,241,.15)
}
.card h2{margin:0 0 16px;font-size:18px}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
input,textarea{
  width:100%;
  padding:14px 16px;
  border-radius:14px;
  border:1px solid #e5e7eb;
  font-family:Poppins;
  outline:none
}
textarea{grid-column:1/3;resize:none}
input:focus,textarea:focus{border-color:var(--primary)}
button{
  margin-top:8px;
  width:100%;
  padding:14px;
  border-radius:16px;
  border:none;
  background:linear-gradient(135deg,var(--primary),var(--secondary));
  color:#fff;
  font-weight:600;
  cursor:pointer;
  box-shadow:0 10px 20px rgba(99,102,241,.35)
}
.search{
  display:flex;gap:10px;margin-bottom:14px
}
.search input{
  background:#f1f5f9;border:none
}
.list{display:flex;flex-direction:column;gap:14px}
.item{
  background:#fff;
  border-radius:18px;
  padding:16px 18px;
  box-shadow:0 10px 20px rgba(0,0,0,.06)
}
.item-header{display:flex;justify-content:space-between;align-items:center}
.item-header b{font-size:15px}
.badge{
  font-size:12px;
  padding:6px 14px;
  border-radius:999px;
  font-weight:500
}
.pending{background:#fef3c7;color:#92400e}
.proses{background:#dbeafe;color:#1e40af}
.selesai{background:#dcfce7;color:#166534}
.rusak{background:#fee2e2;color:#991b1b}
.item p{margin:8px 0 6px;color:#334155}
.item small{color:#64748b}
@media(max-width:640px){
  .grid{grid-template-columns:1fr}
  textarea{grid-column:1}
}
</style>
</head>
<body>
<div class="container">

<div class="header">
<h1>ðŸ“£ Laporan Kendala</h1>
<p>Sampaikan kendala sarana & prasarana secara real-time</p>
</div>

<div class="card">
<h2>âž• Buat Laporan Baru</h2>
<form id="formLaporan">
<div class="grid">
<input id="nama" placeholder="Nama pelapor" required>
<input id="ruangan" placeholder="Ruangan" required>
<textarea id="masalah" rows="3" placeholder="Jelaskan kendala secara singkat" required></textarea>
</div>
<button type="submit">ðŸš€ Kirim Laporan</button>
</form>
</div>

<div class="card">
<h2>ðŸ•’ Riwayat Laporan</h2>
<div class="search">
<input id="searchUser" placeholder="ðŸ” Cari laporan (nama / ruangan / masalah)">
</div>
<div class="list" id="listUser"></div>
</div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, serverTimestamp, query, orderBy } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyBhwT6Z8Hd2KWU-rfbSs5pOv4Yf25Uitzk",
  authDomain: "laporan-kendala-rsgm-b42ce.firebaseapp.com",
  projectId: "laporan-kendala-rsgm-b42ce",
  storageBucket: "laporan-kendala-rsgm-b42ce.firebasestorage.app",
  messagingSenderId: "173817207344",
  appId: "1:173817207344:web:345967805ac4d2906b6bf5",
  measurementId: "G-ZGVRF5HTHG"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

formLaporan.addEventListener("submit",async(e)=>{
  e.preventDefault();
  await addDoc(collection(db,"laporan"),{
    nama:nama.value,
    ruangan:ruangan.value,
    masalah:masalah.value,
    status:"pending",
    waktu:serverTimestamp()
  });
  formLaporan.reset();
});

const q=query(collection(db,"laporan"),orderBy("waktu","desc"));
let cache=[];

onSnapshot(q,(snap)=>{
  cache=[];
  snap.forEach(d=>cache.push(d.data()));
  render(cache);
});

function render(data){
  listUser.innerHTML="";
  data.forEach(x=>{
    listUser.innerHTML+=`<div class="item">
      <div class="item-header">
        <b>${x.nama} â€¢ ${x.ruangan}</b>
        <span class="badge ${x.status}">${x.status}</span>
      </div>
      <p>${x.masalah}</p>
      <small>ðŸ•’ ${x.waktu?.toDate?.().toLocaleString()||""}</small>
    </div>`;
  });
}

searchUser.addEventListener("input",()=>{
  const k=searchUser.value.toLowerCase();
  render(cache.filter(x=>
    x.nama.toLowerCase().includes(k)||
    x.ruangan.toLowerCase().includes(k)||
    x.masalah.toLowerCase().includes(k)
  ));
});
</script>
</body>
</html>>